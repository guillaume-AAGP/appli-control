<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Programmatiste - Pujol Archi 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .checkbox-custom:checked + label { text-decoration: line-through; color: #9ca3af; }
        .tab-active { border-bottom: 4px solid #10b981; color: #10b981; font-weight: 800; }
        input:focus, textarea:focus { border-color: #6366f1; ring: 2px; outline: none; }
        
        .btn-validate {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-validate:hover {
            transform: scale(1.01);
            filter: brightness(1.1);
        }
        .btn-validate:active {
            transform: scale(0.99);
        }
        .control-item {
            @apply flex flex-col gap-3 p-5 bg-slate-50 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-slate-100;
        }
        .note-field {
            @apply w-full text-xs bg-white/50 border border-slate-200 rounded-lg px-3 py-2 outline-none focus:border-emerald-500 focus:bg-white transition-all text-slate-600;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-32">

    <!-- Header -->
    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-2xl border-b border-slate-700">
        <div class="max-w-5xl mx-auto py-5 px-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center font-black text-slate-900">P</div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight uppercase leading-none">Pujol Architecture</h1>
                    <p class="text-[10px] text-emerald-400 font-bold tracking-widest uppercase mt-1">Expert Programmatiste</p>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <div class="text-right hidden sm:block">
                    <p class="text-[9px] uppercase text-slate-500 font-bold tracking-widest">Progression Analyse</p>
                    <div class="flex items-center gap-3">
                        <div class="w-24 h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-700">
                            <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-700 w-0"></div>
                        </div>
                        <span id="progress-text" class="text-sm font-mono text-emerald-400 font-bold">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="bg-slate-900/50 backdrop-blur-md">
            <div class="max-w-5xl mx-auto flex">
                <button onclick="switchTab('tab-infos')" id="btn-infos" class="flex-1 py-4 text-xs font-bold uppercase tracking-widest text-slate-400 hover:text-white transition-all tab-active">
                    1. Fiche Projet
                </button>
                <button onclick="switchTab('tab-controle')" id="btn-controle" class="flex-1 py-4 text-xs font-bold uppercase tracking-widest text-slate-400 hover:text-white transition-all">
                    2. Contrôle & Faisabilité
                </button>
            </div>
        </nav>
    </header>

    <main class="max-w-5xl mx-auto px-4 mt-8">

        <!-- ONGLET 1 : FICHE PROJET -->
        <div id="tab-infos" class="tab-content space-y-6">
            <section class="bg-white rounded-3xl shadow-sm border border-slate-200 p-8">
                <h2 class="text-xl font-bold text-slate-800 mb-8 border-l-4 border-emerald-500 pl-4">Identification du dossier</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="md:col-span-2">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-wider">Nom du Projet</label>
                        <input type="text" id="proj-name" placeholder="Ex: Maison Individuelle - Famille Durant" class="w-full border-slate-100 border-2 rounded-2xl px-5 py-4 bg-slate-50 focus:bg-white transition-all font-medium">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-emerald-600 uppercase mb-2 tracking-wider">Numéro de Dossier (Obligatoire)</label>
                        <input type="text" id="proj-dossier" placeholder="Ex: PC-013-..." class="w-full border-emerald-100 border-2 rounded-2xl px-5 py-4 bg-white focus:ring-4 focus:ring-emerald-50 font-mono font-bold text-lg">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-wider">Salarié en charge du contrôle</label>
                        <input type="text" id="proj-agent" placeholder="Votre Prénom & Nom" class="w-full border-slate-100 border-2 rounded-2xl px-5 py-4 bg-slate-50 focus:bg-white transition-all">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-wider">Surface de Plancher (SdP)</label>
                        <input type="text" id="proj-sdp" placeholder="En m²" class="w-full border-slate-100 border-2 rounded-2xl px-5 py-4 bg-slate-50 focus:bg-white transition-all">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-wider">Date du jour</label>
                        <input type="date" id="proj-date" class="w-full border-slate-100 border-2 rounded-2xl px-5 py-4 bg-slate-50 focus:bg-white transition-all">
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-3xl shadow-sm border border-slate-200 p-8">
                <h2 class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-wider">Commentaires de synthèse</h2>
                <textarea id="notes" rows="6" placeholder="Saisir ici les conclusions générales ou points bloquants majeurs..." class="w-full border-slate-100 border-2 rounded-2xl px-5 py-4 bg-slate-50 text-sm focus:bg-white transition-all"></textarea>
            </section>
        </div>

        <!-- ONGLET 2 : CONTROLE DOSSIER -->
        <div id="tab-controle" class="tab-content hidden space-y-12">
            
            <div class="bg-emerald-50 border border-emerald-100 rounded-2xl p-4 text-emerald-800 text-xs font-medium flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                Note : Remplissez le champ sous chaque point pour préciser les contraintes techniques ou les relevés de faisabilité.
            </div>

            <!-- AUTO-CONTROLE (19 POINTS) -->
            <div class="space-y-6">
                <h3 class="text-sm font-black text-indigo-500 uppercase tracking-widest flex items-center gap-3 ml-2">
                    <span class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-xs text-indigo-600 font-bold">01</span>
                    Auto-Contrôle (Foncier & Terrain)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="section-ac">
                    <!-- Généré par JS -->
                </div>
            </div>

            <!-- PERMIS / AT / DP (23 POINTS) -->
            <div class="space-y-6">
                <h3 class="text-sm font-black text-emerald-600 uppercase tracking-widest flex items-center gap-3 ml-2">
                    <span class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-xs text-emerald-600 font-bold">02</span>
                    Dossier Administratif (PC/DP/AT)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="section-pc">
                    <!-- Généré par JS -->
                </div>
            </div>

            <!-- BOUTON DE VALIDATION -->
            <div class="pt-12">
                <button onclick="validateAndSend()" class="btn-validate w-full bg-emerald-500 text-white py-10 rounded-[2.5rem] font-black text-2xl uppercase tracking-widest shadow-2xl flex flex-col items-center justify-center gap-3 border-b-8 border-emerald-700">
                    <div class="flex items-center gap-5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                        </svg>
                        VALIDER LE DOSSIER
                    </div>
                    <span class="text-xs font-bold opacity-80 tracking-[0.3em]">Transmission des informations à Guillaume Pujol</span>
                </button>
            </div>
        </div>

    </main>

    <!-- Feedback UI -->
    <div id="toast" class="fixed inset-0 bg-emerald-500/90 backdrop-blur-sm z-[100] flex items-center justify-center opacity-0 pointer-events-none transition-all duration-500">
        <div class="text-center text-white">
            <h2 class="text-4xl font-black uppercase mb-2">Analyse Terminée !</h2>
            <p class="text-emerald-100 font-medium font-mono uppercase tracking-widest">Génération du mail de faisabilité...</p>
        </div>
    </div>

    <script>
        const pointsAC = [
            "Recherche de la parcelle sur cadastre.gouv et export d'un extrait de plan",
            "S'informer sur la surface de la parcelle",
            "Rechercher la parcelle sur google earth",
            "Recherche géoportail urbanisme : export règlement complet (OAP, écrit, etc.)",
            "Chercher la zone urbaine et le type de projet",
            "Contrôler le secteur de mixité sociale",
            "Vérifier si la parcelle est concernée par un emplacement réservé",
            "Vérifier si la parcelle se trouve dans un secteur ABF",
            "Vérifier Espace Vert Protégé / Boisé Classé (EBC) sur la parcelle",
            "Contrôler le risque inondation (PPRi)",
            "Contrôler le risque feu de forêt (PPRIF)",
            "Contrôler les risques technologiques éventuels",
            "Contrôler les risques mouvements de terrains et argile",
            "Vérifier le zonage pluvial si il y en a un",
            "Contrôler les servitudes d'utilité publique (Gaz, Canal de Provence...)",
            "Analyser les dispositions générales du règlement",
            "Analyser le règlement de la zone (emprise, hauteur, espaces verts...)",
            "Vérifier la bonne échelle du plan cadastral inséré sur Archicad",
            "Règlement de lotissement ou copropriété ?"
        ];

        const pointsPC = [
            "Contrôle implantation : distance aux voisins",
            "Accès : recul 5m, poubelle, limite espace publique, clôture",
            "Hauteurs Voiries (NGF / TN / TF)",
            "Hauteurs Limite séparative",
            "Hauteurs Entre bâtis",
            "Contrôle Emprise au sol",
            "Contrôle Surface espace vert",
            "Contrôle Surface imperméable",
            "Vérification SdP (Surface de Plancher)",
            "Vérification Surface parcelle réelle",
            "Surface max autorisée (PLU)",
            "Stationnement (Auto, vélo, moto)",
            "Gestion EP : noue, bassin, rétention",
            "Raccordements (EDF, EU, AEP...)",
            "Cotes en PM/Coupe/Façade (NGF & Delta)",
            "Sujet au Gypse", "Sujet Gaz", "Sujet AZAP", "Sujet ZPPAUP",
            "Sujet Feu", "Sujet Inondable", "Sujet mixité sociale",
            "Contrôler les surfaces totales terrain"
        ];

        function createItems(list, containerId, prefix) {
            const container = document.getElementById(containerId);
            list.forEach((point, i) => {
                const id = `${prefix}-${i+1}`;
                const isCritical = point.toLowerCase().includes("inondation") || 
                                 point.toLowerCase().includes("feu de forêt") || 
                                 point.toLowerCase().includes("surface max");
                
                const html = `
                    <div class="control-item ${isCritical ? 'bg-orange-50 border-orange-100 shadow-sm' : ''}">
                        <div class="flex items-start gap-3">
                            <input type="checkbox" id="${id}" class="checkbox-custom mt-1 h-6 w-6 rounded-lg text-emerald-500 border-slate-300">
                            <div class="flex-1">
                                <label for="${id}" class="text-sm text-slate-700 font-bold cursor-pointer block mb-2 leading-snug">${i+1}) ${point}</label>
                                <textarea id="${id}-note" class="note-field" rows="2" placeholder="Note / Précision technique..."></textarea>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        createItems(pointsAC, 'section-ac', 'ac');
        createItems(pointsPC, 'section-pc', 'pc');

        const checkboxes = document.querySelectorAll('.checkbox-custom');
        checkboxes.forEach(cb => cb.addEventListener('change', () => {
            const total = checkboxes.length;
            const checked = document.querySelectorAll('.checkbox-custom:checked').length;
            const percentage = Math.round((checked / total) * 100);
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('progress-text').innerText = percentage + '%';
        }));

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.getElementById('btn-infos').classList.toggle('tab-active', tabId === 'tab-infos');
            document.getElementById('btn-controle').classList.toggle('tab-active', tabId === 'tab-controle');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function validateAndSend() {
            const dossier = document.getElementById('proj-dossier').value.trim();
            if(!dossier) { 
                alert("ERREUR : Le Numéro de dossier est obligatoire !"); 
                switchTab('tab-infos'); 
                document.getElementById('proj-dossier').focus();
                return; 
            }

            let body = `PUJOL ARCHITECTURE - ANALYSE DE FAISABILITÉ DOSSIER : ${dossier}\n`;
            body += `PROJET : ${document.getElementById('proj-name').value || 'Non renseigné'}\n`;
            body += `AGENT : ${document.getElementById('proj-agent').value || 'Non renseigné'}\n`;
            body += `SURFACE SdP : ${document.getElementById('proj-sdp').value || 'N/C'}\n`;
            body += `DATE : ${document.getElementById('proj-date').value || 'Non définie'}\n`;
            body += `COMPLÉTUDE DU CONTRÔLE : ${document.getElementById('progress-text').innerText}\n`;
            body += `==================================================\n\n`;
            
            body += `DÉTAILS DES POINTS DE CONTRÔLE ET NOTES :\n\n`;
            
            checkboxes.forEach(cb => {
                const label = document.querySelector(`label[for="${cb.id}"]`).innerText;
                const note = document.getElementById(cb.id + '-note').value.trim();
                
                body += `${cb.checked ? '[V]' : '[ ]'} ${label}\n`;
                if(note) {
                    body += `   > INFO/NOTE : ${note}\n`;
                } else if (cb.checked) {
                    body += `   > Point validé sans observation particulière.\n`;
                }
                body += `\n`;
            });

            body += `--------------------------------------------------\n`;
            body += `SYNTHÈSE GÉNÉRALE :\n${document.getElementById('notes').value || 'Aucune note de synthèse supplémentaire.'}\n`;
            body += `--------------------------------------------------\n`;
            body += `Fin du rapport technique - Pujol Archi 2026.`;

            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            toast.style.pointerEvents = 'auto';

            setTimeout(() => {
                const subject = `VALIDATION FAISABILITÉ : ${dossier} - ${document.getElementById('proj-name').value || ''}`;
                window.location.href = `mailto:guillaume.pujol@pujol-archi.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                setTimeout(() => { 
                    toast.style.opacity = '0'; 
                    toast.style.pointerEvents = 'none'; 
                }, 3000);
            }, 1000);
        }

        document.getElementById('proj-date').valueAsDate = new Date();
    </script>
</body>
</html>
